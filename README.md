# XLSX-to-DB-parser

## Инструкция по запуску
Для запуска файлы 
При запуске наобходимо указать ConnectionString для своей БД в файле конфигурации appsettings.json (по умолчанию postgresql://postgres:postgres@localhost:5432/postgres)  
Так же в файле конфигурации есть поле xlsx_file_path, в котором указывается путь к файлу с исходными данными (по умолчанию razb_uch.xlsx). Если файл находится в другом месте, путь необходимо изменить  
Кроме того, в файле конфигурации есть поля if_exists_routes и if_exists_route_details, которые указывают, что делать, если добавляемая запись уже существует в соответсвующей таблице (по умолчанию append), можно изменить на fail. pandas.DataFrame.to_sql предоставляет еще одну вариацию этого поля - replace, однако, это не будет работать для таблицы Routes из-за политики действий при удалении.  
Если таблицы не созданы, вызов pandas.DataFrame.to_sql создаст их, однако, если они уже созданы, необходимо, чтобы значения вышеуказанных полей были установены на append для избежания ошибки.  

## Структура БД
![alt text](https://github.com/SSA-hub/XLSX-to-DB-parser/blob/main/RootCode%20DB%20Diagram.png)

## Комментарий

Excel - таблица разделяется на 2 таблицы БД: Route - таблица маршрутов (голубой цвет в Excel-таблице); RouteDetails - таблица деталей маршрутов (телесный цвет в Excel-таблице). В таблице Route хранятся уникальные маршруты (повторения удалены), в таблице RouteDetails - остановки маршрута с внешним ключом, определяющим принадлежность пути к маршруту.  
При вызове SELECT * from Route поля с координатами (например, X_BEG_VOST_UCH) по умолчанию выводятся с меньшей точностью, чем хранятся в xlsx таблице. Чтобы проверить, что данные в БД хранятся с полной точностью, можно использовать выраженние select to_char(X_BEG_VOST_UCH, 'FM99999.00000000000000') from Route;  
Код загружен в двух форматах - для Jupiter Notebook и в разрешении .py
